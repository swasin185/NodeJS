for(var __awaiter=this&&this.__awaiter||function(i,l,c,d){return new(c=c||Promise)(function(n,t){function e(i){try{r(d.next(i))}catch(i){t(i)}}function o(i){try{r(d.throw(i))}catch(i){t(i)}}function r(i){var t;i.done?n(i.value):((t=i.value)instanceof c?t:new c(function(i){i(t)})).then(e,o)}r((d=d.apply(i,l||[])).next())})},__generator=this&&this.__generator||function(n,e){var o,r,l,c={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},i={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function t(t){return function(i){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(l=2&t[0]?r.return:t[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,t[1])).done)return l;switch(r=0,(t=l?[2&t[0],l.value]:t)[0]){case 0:case 1:l=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,r=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(l=0<(l=c.trys).length&&l[l.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!l||t[1]>l[0]&&t[1]<l[3])){c.label=t[1];break}if(6===t[0]&&c.label<l[1]){c.label=l[1],l=t;break}if(l&&c.label<l[2]){c.label=l[2],c.ops.push(t);break}l[2]&&c.ops.pop(),c.trys.pop();continue}t=e.call(n,c)}catch(i){t=[6,i],r=0}finally{o=l=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,i])}}},cv=document.getElementById("cpxCanvas"),cx=cv.getContext("2d"),WIDTH=cv.width,HEIGHT=cv.height,textWidth=document.getElementById("width"),textHeight=document.getElementById("height"),n=Number(textWidth.value),m=Number(textHeight.value),w=WIDTH/n,h=HEIGHT/m,blocks=new Array(m),path=new Array(m),found_i=0,found_j=0,start_i=1,start_j=1,finish_i=m-2,finish_j=n-2,di=start_i,dj=start_j,pathCount=0,maxStep=0,colors=new Array(100),i=0;i<colors.length;i++)colors[i]=rgb(50+2*i,255-2*i,150+i);function mazeGenerate(){return __awaiter(this,void 0,void 0,function(){var t,e,o,r,l;return __generator(this,function(i){for(n=Number(textWidth.value),m=Number(textHeight.value),w=WIDTH/n,h=HEIGHT/m,blocks=new Array(m),path=new Array(m),t=0;t<m;t++)blocks[t]=new Array(n),blocks[t].fill(-1),path[t]=new Array(n),path[t].fill(-1);for(di=start_i,dj=start_j,finish_i=2*Math.floor(Math.random()*(m-2)/2)+1,finish_j=2*Math.floor(Math.random()*(n-2)/2)+1,finish_i<m/2&&(finish_i=2*finish_i-1),finish_j<n/2&&(finish_j=2*finish_j-1),console.log("finish=",finish_i,finish_j),o=-(e=1),l=!(r=1);0<e;)blocks[di][dj]<0?(blocks[di][dj]=r++,l=!1):r=blocks[di][dj]+1,di%2==1&&dj%2==1&&(o=e=0,1<di&&-1==blocks[di-2][dj]&&(e++,o+=1),1<dj&&-1==blocks[di][dj-2]&&(e++,o+=2),di<m-2&&-1==blocks[di+2][dj]&&(e++,o+=4),dj<n-2&&-1==blocks[di][dj+2]&&(e++,o+=8),e=randomDirection(o,e)),0!=e||di==start_i&&dj==start_j||(0<(e=goBack())&&!l&&connnectDeadEnd(e),l=!0),move(e);return resetMaze(),[2]})})}function howFarFromFinish(){return finish_i&&finish_j?Math.abs(finish_i-di)+Math.abs(finish_j-dj):-1}function resetMaze(){found_j=found_i=void 0,di=start_i,dj=start_j;for(var i=maxStep=0;i<m;i++)for(var t=0;t<n;t++)path[i][t]=-1;for(i=pathCount=0;i<m;i++)for(t=0;t<n;t++)-1<blocks[i][t]&&(blocks[i][t]=null);paint()}function connnectDeadEnd(i){1<di&&4==i&&-1==blocks[di-1][dj]&&blocks[di][dj]-blocks[di-2][dj]>m?blocks[di-1][dj]=0:1<dj&&8==i&&-1==blocks[di][dj-1]&&blocks[di][dj]-blocks[di][dj-2]>m?blocks[di][dj-1]=0:di<m-2&&1==i&&-1==blocks[di+1][dj]&&blocks[di][dj]-blocks[di+2][dj]>n?blocks[di+1][dj]=0:dj<n-2&&2==i&&-1==blocks[di][dj+1]&&blocks[di][dj]-blocks[di][dj+2]>n&&(blocks[di][dj+1]=0)}function depthFirstSearch(){return __awaiter(this,void 0,void 0,function(){var t,e,o,r,l;return __generator(this,function(i){switch(i.label){case 0:resetMaze(),e=t=1,r=m*n,l=o=0,i.label=1;case 1:return 0<t?(l++,null==blocks[di][dj]||blocks[di][dj]>e?null!=blocks[di][dj]?[3,3]:(paint(),[4,new Promise(function(i){return setTimeout(i,5)})]):[3,6]):[3,8];case 2:i.sent(),i.label=3;case 3:return(maxStep<e&&(maxStep=e),blocks[di][dj]=e++,di!=finish_i||dj!=finish_j)?[3,5]:(found_i=finish_i,found_j=finish_j,maxStep=r=e-1,createPath(),paint(),[4,new Promise(function(i){return setTimeout(i,50)})]);case 4:i.sent(),i.label=5;case 5:return[3,7];case 6:e=blocks[di][dj]+1,i.label=7;case 7:return t=0,e+howFarFromFinish()<r&&(o=0,1<di&&isNextBlock(blocks[di][dj],blocks[di-1][dj])&&(t++,o+=1),1<dj&&isNextBlock(blocks[di][dj],blocks[di][dj-1])&&(t++,o+=2),di<m-2&&isNextBlock(blocks[di][dj],blocks[di+1][dj])&&(t++,o+=4),dj<n-2&&isNextBlock(blocks[di][dj],blocks[di][dj+1])&&(t++,o+=8),t=selectDirection(o,t)),move(t=0==t?goBack():t),[3,1];case 8:return paint(),console.log("maxStep="+maxStep,"time="+l),[2]}})})}function createPath(){pathCount++;for(var i=0;i<m;i++)path[i]=new Array(n),path[i].fill(-1);var t=di,e=dj;di=finish_i,dj=finish_j;for(var o,r=1;1!=di||1!=dj;)r++,o=goBack(),path[di][dj]=blocks[di][dj],move(o);di=t,dj=e,console.log("path["+pathCount+"] = "+r)}function move(i){1==i?di--:2==i?dj--:4==i?di++:8==i&&dj++}function goBack(){var i=0;return 1<di&&isPriorBlock(blocks[di][dj],blocks[di-1][dj])?i=1:1<dj&&isPriorBlock(blocks[di][dj],blocks[di][dj-1])?i=2:di<m-1&&isPriorBlock(blocks[di][dj],blocks[di+1][dj])?i=4:dj<n-1&&isPriorBlock(blocks[di][dj],blocks[di][dj+1])&&(i=8),i}function isPriorBlock(i,t){return i==t+1}function isNextBlock(i,t){return null==t||1<t-i}function randomDirection(i,t){var n=0;if(0<t){for(var e=Math.floor(Math.random()*t),n=1,o=0;o<e;o++){for(;0==(n&i)&&n<=8;)n<<=1;n<<=1}for(;0==(n&i)&&n<=8;)n<<=1}return n}function selectDirection(i,t){var n=0;if(0<t)for(n=1;0==(n&i)&&n<=8;)n<<=1;return n}function paint(){cx.clearRect(0,0,WIDTH,HEIGHT);var i,t;cx.fillStyle="white",cx.strokeStyle="black";for(var e=0;e<m;e++)for(var o=0;o<n;o++)-1!=blocks[e][o]&&(i=o*w,t=e*h,-1!=path[e][o]?cx.fillStyle="yellow":blocks[e][o]<=maxStep?null!=blocks[e][o]?cx.fillStyle=colors[Math.round(blocks[e][o]/maxStep*(colors.length-1))]:cx.fillStyle="white":cx.fillStyle="grey",cx.fillRect(i,t,w-1,h-1));cx.fillStyle="orange",cx.fillRect(dj*w,di*h,w-1,h-1),cx.fillStyle="blue",cx.fillRect(start_j*w,start_i*h,w-1,h-1),found_i&&found_j&&(cx.fillStyle="red",cx.fillRect(found_j*w,found_i*h,w-1,h-1))}function rgb(i,t,n){return(240&i?"#":"#0")+(0==i?"0":"")+(i<<16|t<<8|n).toString(16)}mazeGenerate();