for(var ComplexNumber=function(){function o(e,t){this.re=0,this.im=0,this.re=e,this.im=t}return o.prototype.absolute=function(){return Math.hypot(this.re,this.im)},o.prototype.add=function(e){this.re=Math.round((this.re+e.re)*o.PRECISION)/o.PRECISION,this.im=Math.round((this.im+e.im)*o.PRECISION)/o.PRECISION},o.prototype.getImage=function(){return this.im},o.prototype.getReal=function(){return this.re},o.prototype.multiply=function(e){var t=this.re*e.re-this.im*e.im,a=this.re*e.im+this.im*e.re;this.re=Math.round(t*o.PRECISION)/o.PRECISION,this.im=Math.round(a*o.PRECISION)/o.PRECISION},o.prototype.power2=function(){this.multiply(this)},o.PRECISION=1e12,o}(),canvas=document.getElementById("cpxCanvas"),ctx=canvas.getContext("2d"),boxReal=document.getElementById("realValue"),boxImage=document.getElementById("imageValue"),boxBoundary=document.getElementById("boundary"),txtRunTime=document.getElementById("runTime"),WIDTH=canvas.width,HEIGHT=canvas.height,MID_WIDTH=canvas.width/2,MID_HEIGHT=canvas.height/2,MAX_N=51,PALETTE=new Array(MAX_N),level=0,x=Math.floor(3*Math.random()),i=0;i<MAX_N;i++)PALETTE[i]=new Array(3),level=5*i,PALETTE[i][x+i%3]=level,PALETTE[i][(x+i+1)%3]=Math.floor(Math.random()*level/2+level/2),PALETTE[i][(x+i+2)%3]=Math.floor(Math.random()*level/2+level/2);var boundary,center_real,center_image,center,imgData=ctx.createImageData(WIDTH,HEIGHT),data=imgData.data;function calculate(){console.log("calculate");var e=(new Date).getTime();boundary=Number(boxBoundary.value),center_real=Number(boxReal.value),center_image=Number(boxImage.value),center=new ComplexNumber(center_real,center_image);for(var t,a,o,r,n,I,i=Math.PI,m=new ComplexNumber(-.5,-.5),l=0,u=0;u<HEIGHT;u++){a=Math.round((u-MID_HEIGHT)*boundary/HEIGHT*ComplexNumber.PRECISION)/ComplexNumber.PRECISION+center_image,console.log(u/HEIGHT*100,"%");for(var T=0;T<WIDTH;T++){for(o=Math.round((T-MID_WIDTH)*boundary/WIDTH*ComplexNumber.PRECISION)/ComplexNumber.PRECISION+center_real,m=new ComplexNumber(o,a),t=new ComplexNumber(o,a),l=1;l<MAX_N&&t.absolute()<i;)n=t.getReal(),I=t.getImage(),t.power2(),t.add(m),t.getReal()==n&&t.getImage()==I?l=MAX_N:l++;l--,data[r=4*(u*WIDTH+T)]=PALETTE[l][0],data[++r]=PALETTE[l][1],data[++r]=PALETTE[l][2],data[++r]=255}}paint(),e=(new Date).getTime()-e,txtRunTime.innerHTML="run time = "+e/1e3+" seconds"}function clickXY(e){var t=e.offsetX,a=e.offsetY;boxReal.value=String(center_real+Math.round((t-MID_WIDTH)*boundary/WIDTH*ComplexNumber.PRECISION)/ComplexNumber.PRECISION),boxImage.value=String(center_image- -Math.round((a-MID_HEIGHT)*boundary/HEIGHT*ComplexNumber.PRECISION)/ComplexNumber.PRECISION),0==e.button?boundary/=10:boundary*=10,boxBoundary.value=String(boundary),calculate()}function paint(){ctx.putImageData(imgData,0,0);for(var e=0;e<=WIDTH;e+=100)ctx.moveTo(e,0),ctx.lineTo(e,5),ctx.moveTo(e,HEIGHT),ctx.lineTo(e,HEIGHT-5);for(var t=0;t<=HEIGHT;t+=100)ctx.moveTo(0,t),ctx.lineTo(5,t),ctx.moveTo(WIDTH,t),ctx.lineTo(WIDTH-5,t);ctx.moveTo(MID_WIDTH-5,MID_HEIGHT),ctx.lineTo(MID_WIDTH+5,MID_HEIGHT),ctx.moveTo(MID_WIDTH,MID_HEIGHT-5),ctx.lineTo(MID_WIDTH,MID_HEIGHT+5),ctx.stroke()}paint(),calculate();