for(var ComplexNumber=function(){function e(e,t){this.re=e,this.im=t}return e.prototype.absolute=function(){return this.re*this.re+this.im*this.im},e.prototype.add=function(e){this.re=this.re+e.re,this.im=this.im+e.im},e.prototype.getImage=function(){return this.im},e.prototype.getReal=function(){return this.re},e.prototype.multiply=function(e){var t=this.re*e.re-this.im*e.im,e=this.re*e.im+this.im*e.re;this.re=t,this.im=e},e.prototype.power2=function(){this.multiply(this)},e}(),canvas=document.getElementById("cpxCanvas"),ctx=canvas.getContext("2d"),boxReal=document.getElementById("realValue"),boxImage=document.getElementById("imageValue"),boxBoundary=document.getElementById("boundary"),txtRunTime=document.getElementById("runTime"),WIDTH=canvas.width,HEIGHT=canvas.height,MID_WIDTH=canvas.width/2,MID_HEIGHT=canvas.height/2,MAX_N=500,PALETTE=new Array(MAX_N),i=0;i<=MAX_N;i++)PALETTE[i]=new Array(3),PALETTE[i][0]=35*i%250,PALETTE[i][1]=20*i%200,PALETTE[i][2]=10*i%250;var boundary,center_real,center_image,center,imgData=ctx.createImageData(WIDTH,HEIGHT),data=imgData.data;function calculate(){console.log("calculate");var e=(new Date).getTime();boundary=Number(boxBoundary.value),center_real=Number(boxReal.value),center_image=-Number(boxImage.value),center=new ComplexNumber(center_real,center_image);for(var t,a,n,r,o,i=center_real-boundary/2,c=0,m=boundary/WIDTH,u=center_image-boundary/2,T=0;T<HEIGHT;T++){for(var l=i,I=0;I<WIDTH;I++){for(t=new ComplexNumber(l,u),a=new ComplexNumber(l,u),c=0,r=o=null;c<MAX_N&&a.absolute()<4&&(o!=a.getReal()||r!=a.getImage());)o=a.getReal(),r=a.getImage(),a.power2(),a.add(t),c++;data[n=4*(T*WIDTH+I)]=PALETTE[c][0],data[++n]=PALETTE[c][1],data[++n]=PALETTE[c][2],data[++n]=255,l+=m}u+=m}paint(),e=(new Date).getTime()-e,txtRunTime.innerHTML="run time = "+e/1e3+" seconds"}function clickXY(e){var t=e.offsetX,a=e.offsetY;boxReal.value=String(center_real+(t-MID_WIDTH)*boundary/WIDTH),boxImage.value=String(-center_image-(a-MID_HEIGHT)*boundary/HEIGHT),0==e.button?boundary/=1.618034:boundary*=1.618034,boxBoundary.value=String(boundary),calculate()}function paint(){ctx.putImageData(imgData,0,0);for(var e=0;e<=WIDTH;e+=100)ctx.moveTo(e,0),ctx.lineTo(e,5),ctx.moveTo(e,HEIGHT),ctx.lineTo(e,HEIGHT-5);for(var t=0;t<=HEIGHT;t+=100)ctx.moveTo(0,t),ctx.lineTo(5,t),ctx.moveTo(WIDTH,t),ctx.lineTo(WIDTH-5,t);ctx.moveTo(MID_WIDTH-5,MID_HEIGHT),ctx.lineTo(MID_WIDTH+5,MID_HEIGHT),ctx.moveTo(MID_WIDTH,MID_HEIGHT-5),ctx.lineTo(MID_WIDTH,MID_HEIGHT+5),ctx.stroke()}paint(),calculate();