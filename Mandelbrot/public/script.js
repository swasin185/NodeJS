for(var ComplexNumber=function(){function r(e,t){this.re=0,this.im=0,this.re=e,this.im=t}return r.prototype.absolute=function(){return Math.hypot(this.re,this.im)},r.prototype.add=function(e){this.re=Math.round((this.re+e.re)*r.PRECISION)/r.PRECISION,this.im=Math.round((this.im+e.im)*r.PRECISION)/r.PRECISION},r.prototype.getImage=function(){return this.im},r.prototype.getReal=function(){return this.re},r.prototype.multiply=function(e){var t=this.re*e.re-this.im*e.im,a=this.re*e.im+this.im*e.re;this.re=Math.round(t*r.PRECISION)/r.PRECISION,this.im=Math.round(a*r.PRECISION)/r.PRECISION},r.prototype.power2=function(){this.multiply(this)},r.PRECISION=1e16,r}(),canvas=document.getElementById("cpxCanvas"),ctx=canvas.getContext("2d"),boxReal=document.getElementById("realValue"),boxImage=document.getElementById("imageValue"),boxBoundary=document.getElementById("boundary"),txtRunTime=document.getElementById("runTime"),WIDTH=canvas.width,HEIGHT=canvas.height,MID_WIDTH=canvas.width/2,MID_HEIGHT=canvas.height/2,MAX_N=51,PALETTE=new Array(MAX_N),i=0;i<10;i++)PALETTE[i]=new Array(3),PALETTE[i][0]=10*i,PALETTE[i][1]=PALETTE[i][0],PALETTE[i][2]=PALETTE[i][0];for(i=10;i<PALETTE.length;i++)PALETTE[i]=new Array(3),PALETTE[i][0]=Math.floor(255*Math.random()),PALETTE[i][1]=Math.floor(255*Math.random()),PALETTE[i][2]=Math.floor(255*Math.random());var boundary,center_real,center_image,center,imgData=ctx.createImageData(WIDTH,HEIGHT),data=imgData.data;function calculate(){var e=(new Date).getTime();boundary=Number(boxBoundary.value),center_real=Number(boxReal.value),center_image=Number(boxImage.value),center=new ComplexNumber(center_real,center_image);for(var t,a,r,o,n=0,i=0;i<HEIGHT;i++){a=Math.round((i-MID_HEIGHT)*boundary/HEIGHT*ComplexNumber.PRECISION)/ComplexNumber.PRECISION+center_image;for(var I=0;I<WIDTH;I++){r=Math.round((I-MID_WIDTH)*boundary/WIDTH*ComplexNumber.PRECISION)/ComplexNumber.PRECISION+center_real;for(var m=(t=new ComplexNumber(r,a)).getReal(),T=t.getImage(),u=new ComplexNumber(m,T),n=1;n<MAX_N&&u.absolute()<2;)u.power2(),u.add(t),u.getReal()==m&&u.getImage()==T?n=MAX_N:n++,m=u.getReal(),T=u.getImage();n--,data[o=4*(i*WIDTH+I)]=PALETTE[n][0],data[++o]=PALETTE[n][1],data[++o]=PALETTE[n][2],data[++o]=255}}paint(),e=(new Date).getTime()-e,txtRunTime.innerHTML="run time = "+e/1e3+" seconds"}function clickXY(e){var t=e.offsetX,a=e.offsetY;boxReal.value=String(center_real+Math.round((t-MID_WIDTH)*boundary/WIDTH*ComplexNumber.PRECISION)/ComplexNumber.PRECISION),boxImage.value=String(center_image- -Math.round((a-MID_HEIGHT)*boundary/HEIGHT*ComplexNumber.PRECISION)/ComplexNumber.PRECISION),paint()}function paint(){ctx.putImageData(imgData,0,0);for(var e=0;e<=WIDTH;e+=100)ctx.moveTo(e,0),ctx.lineTo(e,5),ctx.moveTo(e,HEIGHT),ctx.lineTo(e,HEIGHT-5);for(var t=0;t<=HEIGHT;t+=100)ctx.moveTo(0,t),ctx.lineTo(5,t),ctx.moveTo(WIDTH,t),ctx.lineTo(WIDTH-5,t);ctx.moveTo(MID_WIDTH-5,MID_HEIGHT),ctx.lineTo(MID_WIDTH+5,MID_HEIGHT),ctx.moveTo(MID_WIDTH,MID_HEIGHT-5),ctx.lineTo(MID_WIDTH,MID_HEIGHT+5),ctx.stroke()}calculate();